<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Snake â€” HTML/CSS/JS</title>
  <style>
    :root {
      --bg: #1f1f24;
      --board: #2a2d32;
      --snake: #59f2a1;
      --snake-head: #3bd586;
      --food: #ff6b6b;
      --text: #e8ecf1;
      --accent: #7aa2f7;
    }

    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: radial-gradient(1200px circle at 20% 10%, #141a34 20%, var(--bg));
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color: var(--text);
      background-color: #1f1f24;
    }

    .wrap {
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .game {
      width: min(95vw, 1000px);
      display: grid;
      gap: 12px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .title {
      font-weight: 700;
      letter-spacing: 0.2px;
      color: var(--accent);
    }

    .stats {
      display: flex;
      gap: 12px;
      font-weight: 600;
    }

    .board {
      border-radius: 12px;
      position: relative;
      background: var(--board);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.06);
      overflow: hidden;
      width: 100%;
      height: 60vh; /* rectangle proportionnel */
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .btn {
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid #2a315f;
      background: #161b36;
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
      transition: transform 80ms ease, background 120ms ease, box-shadow 120ms ease;
      box-shadow: 0 6px 16px rgba(0,0,0,0.25);
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }

    .overlay {
      position: absolute;
      inset: 0;
      display: none;
      background: rgba(10, 14, 30, 0.78);
      backdrop-filter: blur(2px);
      color: var(--text);
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 24px;
    }
    .overlay.show { display: flex; }

    .overlay .card {
      background: #12162b;
      border: 1px solid #2a315f;
      border-radius: 12px;
      padding: 16px 18px;
      max-width: 90%;
      box-shadow: 0 10px 24px rgba(0,0,0,0.35);
    }

    .muted { color: #9aa3bc; font-weight: 500; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="game">
      <div class="topbar">
        <div class="title">Snake</div>
        <div class="stats">
          <div>Score: <span id="score">0</span></div>
          <div>Record: <span id="best">0</span></div>
        </div>
      </div>

      <div class="board" id="board">
        <canvas id="canvas"></canvas>
        <div class="overlay" id="overlay">
          <div class="card">
            <h3 style="margin: 0 0 6px;">Game over</h3>
            <p class="muted" style="margin: 0 0 12px;">Appuie sur R pour recommencer</p>
            <button class="btn" id="restartBtn">Recommencer</button>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="btn" id="pauseBtn">Pause</button>
        <button class="btn" id="restartBtn2">Restart (R)</button>
      </div>
    </div>
  </div>

  <script>
    const GRID_WIDTH = 40;   // cellules horizontales
    const GRID_HEIGHT = 25;  // cellules verticales
    const STEP_MS = 120;
    const GROWTH = 1;
    const START_LEN = 4;

    const canvas = document.getElementById('canvas');
    const boardEl = document.getElementById('board');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
      const rect = boardEl.getBoundingClientRect();
      const dpr = Math.max(1, Math.floor(window.devicePixelRatio || 1));
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      canvas.style.width = rect.width + 'px';
      canvas.style.height = rect.height + 'px';
      cellPxX = Math.floor(canvas.width / GRID_WIDTH);
      cellPxY = Math.floor(canvas.height / GRID_HEIGHT);
    }
    let cellPxX = 16, cellPxY = 16;
    window.addEventListener('resize', resizeCanvas);

    let snake, dir, nextDir, food, score, over, paused, timer;

    function reset() {
      snake = [];
      for (let i = START_LEN - 1; i >= 0; i--) {
        snake.push({ x: Math.floor(GRID_WIDTH/2) - i, y: Math.floor(GRID_HEIGHT/2) });
      }
      dir = nextDir = { x: 1, y: 0 };
      food = spawnFood(snake);
      score = 0;
      over = false;
      paused = false;
      updateScore();
      hideOverlay();
    }

    function updateScore() {
      document.getElementById('score').textContent = score;
      const prev = Number(localStorage.getItem('snake_best') || '0');
      if (score > prev) localStorage.setItem('snake_best', String(score));
      document.getElementById('best').textContent = localStorage.getItem('snake_best') || '0';
    }

    function spawnFood(occupied) {
      let x, y;
      do {
        x = Math.floor(Math.random() * GRID_WIDTH);
        y = Math.floor(Math.random() * GRID_HEIGHT);
      } while (occupied.some(c => c.x === x && c.y === y));
      return { x, y };
    }

    function setDir(nx, ny) {
      if (nx === -dir.x && ny === -dir.y) return;
      nextDir = { x: nx, y: ny };
    }

    function step() {
      if (paused || over) return;
      dir = nextDir;

      const head = snake[snake.length - 1];
      let nx = head.x + dir.x;
      let ny = head.y + dir.y;

      // wrap-around
      if (nx < 0) nx = GRID_WIDTH - 1;
      if (nx >= GRID_WIDTH) nx = 0;
      if (ny < 0) ny = GRID_HEIGHT - 1;
      if (ny >= GRID_HEIGHT) ny = 0;

      if (snake.some(c => c.x === nx && c.y === ny)) return gameOver();

      snake.push({ x: nx, y: ny });

      if (nx === food.x && ny === food.y) {
        score++;
        updateScore();
        food = spawnFood(snake);
        for (let g = 1; g < GROWTH; g++) snake.unshift({ ...snake[0] });
      } else {
        snake.shift();
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--food').trim();
      rect(food.x, food.y, 0.9, cellPxX, cellPxY);

      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--snake').trim();
      for (let i = 0; i < snake.length - 1; i++) rect(snake[i].x, snake[i].y, 0.9, cellPxX, cellPxY);

      const head = snake[snake.length - 1];
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--snake-head').trim();
      rect(head.x, head.y, 0.95, cellPxX, cellPxY);
    }

    function rect(gx, gy, scale, pxX, pxY) {
      const padX = Math.floor((1 - scale) * pxX * 0.5);
      const padY = Math.floor((1 - scale) * pxY * 0.5);
      ctx.fillRect(
        gx * pxX + padX,
        gy * pxY + padY,
        pxX - padX * 2,
        pxY - padY * 2
      );
    }

    function loop() { step(); draw(); }

    function start() {
      resizeCanvas();
      reset();
      clearInterval(timer);
      timer = setInterval(loop, STEP_MS);
    }

    function pauseToggle() {
      if (over) return;
      paused = !paused;
      document.getElementById('pauseBtn').textContent = paused ? 'Reprendre' : 'Pause';
    }

    function gameOver() { over = true; showOverlay(); }
    function showOverlay() { document.getElementById('overlay').classList.add('show'); }
    function hideOverlay() { document.getElementById('overlay').classList.remove('show'); }

    const keys = {
      ArrowUp: () => setDir(0, -1),
      ArrowDown: () => setDir(0, 1),
      ArrowLeft: () => setDir(-1, 0),
      ArrowRight: () => setDir(1, 0),
      w: () => setDir(0, -1), s: () => setDir(0, 1),
      a: () => setDir(-1, 0), d: () => setDir(1, 0),
      W: () => setDir(0, -1), S: () => setDir(0, 1),
      A: () => setDir(-1, 0), D: () => setDir(1, 0)
    };

    document.addEventListener('keydown', e => {
      if (e.key === 'p' || e.key === 'P') { pauseToggle(); return; }
      if (e.key === 'r' || e.key === 'R') { start(); return; }
      if (keys[e.key]) keys[e.key]();
    });

    document.getElementById('pauseBtn').addEventListener('click', pauseToggle);
    document.getElementById('restartBtn').addEventListener('click', start);
    document.getElementById('restartBtn2').addEventListener('click', start);

    start();
  </script>
</body>
</html>
