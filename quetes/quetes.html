<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>NIRD - Système de Quêtes</title>
  <style>
/* Ubuntu-like dark blue theme */
:root {
  --bg: #141a2a;
  --surface: #1c2236;
  --surface-2: #22283f;

  --text: #FFFFFF;
  --text-dim: #A0A8C0;

  --accent-orange: #DD4814;
  --accent-light: #FF7F50;

  --radius: 12px;
  --radius-sm: 8px;
}

/* Base */
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; }
body {
  font-family: 'Ubuntu', sans-serif;
  background: var(--bg);
  color: var(--text);
  padding: 32px; /* padding global augmenté */
}

/* Utilities */
.hidden { display: none !important; }

/* Headings */
h1, h2 {
  margin: 0 0 16px;
  letter-spacing: .3px;
}

/* Grid of theme cards */
.grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 28px; /* un peu plus d’espace entre les cartes */
}

/* Card style */
.card, #themeDetail, #questDetail, #themesPage {
  border-radius: var(--radius);
  padding: 24px; /* padding intérieur augmenté */
  background: linear-gradient(180deg, var(--surface), var(--surface-2));
  color: var(--text);
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  border: none;
  transition: transform 0.2s, box-shadow 0.2s;
  cursor: pointer;
}
.card:hover, #themeDetail:hover, #questDetail:hover, #themesPage:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 18px rgba(0,0,0,0.6);
}

/* Theme/Quest progress text */
.theme-progress-text, .quest-progress-text {
  margin: 8px 0 10px;
  color: var(--text-dim);
}

/* Buttons */
button {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 12px 18px; /* padding augmenté */
  border-radius: var(--radius-sm);
  background: var(--accent-orange);
  color: #fff;
  font-weight: 700;
  border: none;
  cursor: pointer;
  transition: transform 0.2s, background 0.2s, box-shadow 0.2s;
}
button:hover {
  background: var(--accent-light);
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.4);
}
button:active {
  transform: scale(0.98);
}

/* Quests list */
#questsList {
  list-style: none;
  padding: 0;
  margin: 0;
}
#questsList li { margin: 12px 0; }
#questsList li button {
  width: 100%;
  justify-content: flex-start;
  background: linear-gradient(180deg, var(--surface), var(--surface-2));
  padding: 14px 18px; /* padding augmenté */
}

/* Steps list */
#stepsList {
  list-style: none;
  padding: 0;
  margin: 16px 0 0;
}
#stepsList li {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 18px; /* padding augmenté */
  margin-bottom: 12px;
  border-radius: var(--radius-sm);
  background: linear-gradient(180deg, var(--surface), var(--surface-2));
  position: relative;
}

/* Checkboxes */
#stepsList input[type=checkbox] {
  width: 20px;
  height: 20px;
  appearance: none;
  border-radius: 4px;
  border: 2px solid var(--accent-orange);
  background: var(--surface);
  cursor: pointer;
  transition: background 0.2s, border 0.2s;
}
#stepsList input[type=checkbox]:checked {
  background: var(--accent-light);
  border-color: var(--accent-light);
}

/* Progress bar */
.progress {
  height: 12px; /* légèrement plus épais */
  background: #0f111b;
  border-radius: 999px;
  overflow: hidden;
}
.progress-bar {
  height: 100%;
  width: 0%;
  background: var(--accent-orange);
  border-radius: 999px;
  transition: width .25s ease-in-out;
}

/* Meta info spacing */
p, ul { padding: 0; }

  </style>
</head>
<body>

  <!-- Page des thèmes -->
  <div id="themesPage">
    <h1>Vos missions</h1>
    <div class="grid" id="themesGrid"></div>
  </div>

  <!-- Page d’un thème -->
  <div id="themeDetail" class="hidden">
    <button onclick="showThemes()">⬅ Retour</button>
    <h2 id="themeTitle"></h2>
    <ul id="questsList"></ul>
  </div>

  <!-- Page d’une quête -->
<div id="questDetail" class="hidden">
  <button onclick="showTheme()">⬅ Retour</button>
  <h2 id="questTitle"></h2>
  <p>Progression : <span id="questProgress">0%</span></p>

  <div class="progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <ul id="stepsList"></ul>
</div>

<script>
// --- DONNÉES ---
const data = {
  themes: [
    {
      name: "Logiciels Libres",
      quests: [
        { title: "Découvrir les alternatives libres", steps: ["Identifier un logiciel propriétaire utilisé", "Trouver son équivalent libre", "Installer et tester en classe", "Partager un retour d’expérience"] },
        { title: "Former les utilisateurs", steps: ["Créer un mini-guide ou tutoriel", "Organiser une séance de découverte", "Collecter les impressions"] }
      ]
    },
    {
      name: "Durabilité du matériel",
      quests: [
        { title: "Allonger la durée de vie des PC", steps: ["Vérifier l’état des machines", "Installer un OS léger", "Tester la compatibilité", "Documenter la procédure"] }
      ]
    }
  ]
};

// Initialiser completedSteps
data.themes.forEach(theme => {
  theme.quests.forEach(quest => {
    if (!quest.completedSteps) quest.completedSteps = Array(quest.steps.length).fill(false);
  });
});

let currentTheme = null;
let currentQuest = null;

// Affichage thèmes
function showThemes() {
  document.getElementById("themesPage").classList.remove("hidden");
  document.getElementById("themeDetail").classList.add("hidden");
  document.getElementById("questDetail").classList.add("hidden");

  const grid = document.getElementById("themesGrid");
  grid.innerHTML = "";
  data.themes.forEach((theme, idx) => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `<h3>${theme.name}</h3><p>${theme.quests.length} quêtes</p>`;

    // Progression thème
    let total = 0;
    theme.quests.forEach(q => { total += Math.round((q.completedSteps.filter(v=>v).length / q.steps.length) *100); });
    const themeProgressValue = Math.round(total / theme.quests.length);

    // Texte progression
    const themeProgressText = document.createElement("p");
    themeProgressText.className = "theme-progress-text";
    themeProgressText.textContent = "Progression : " + themeProgressValue + "%";
    div.appendChild(themeProgressText);

    // Barre de progression
    const themeProgress = document.createElement("div");
    themeProgress.className = "progress";
    const themeProgressBar = document.createElement("div");
    themeProgressBar.className = "progress-bar";
    themeProgressBar.style.width = themeProgressValue + "%";
    themeProgress.appendChild(themeProgressBar);
    div.appendChild(themeProgress);

    div.onclick = () => showTheme(idx);
    grid.appendChild(div);
  });
}

// Affichage thème
function showTheme(index=null){
  if(index!==null) currentTheme=data.themes[index];
  document.getElementById("themesPage").classList.add("hidden");
  document.getElementById("themeDetail").classList.remove("hidden");
  document.getElementById("questDetail").classList.add("hidden");

  document.getElementById("themeTitle").textContent=currentTheme.name;
  const list=document.getElementById("questsList");
  list.innerHTML="";
  currentTheme.quests.forEach((quest,idx)=>{
    const li=document.createElement("li");
    const btn=document.createElement("button");
    btn.textContent=quest.title;
    btn.onclick=()=>showQuest(idx);

    // Progression
    const qProgress = Math.round((quest.completedSteps.filter(v=>v).length / quest.steps.length)*100);
    const questProgressText=document.createElement("p");
    questProgressText.className="quest-progress-text";
    questProgressText.textContent="Progression : "+qProgress+"%";

    const questProgress=document.createElement("div");
    questProgress.className="progress";
    const questProgressBar=document.createElement("div");
    questProgressBar.className="progress-bar";
    questProgressBar.style.width=qProgress+"%";
    questProgress.appendChild(questProgressBar);

    li.appendChild(btn);
    li.appendChild(questProgressText);
    li.appendChild(questProgress);
    list.appendChild(li);
  });
}

// Affichage quête
function showQuest(index){
  currentQuest=currentTheme.quests[index];
  document.getElementById("themesPage").classList.add("hidden");
  document.getElementById("themeDetail").classList.add("hidden");
  document.getElementById("questDetail").classList.remove("hidden");

  document.getElementById("questTitle").textContent=currentQuest.title;
  const list=document.getElementById("stepsList");
  list.innerHTML="";

  currentQuest.steps.forEach((step,idx)=>{
    const li=document.createElement("li");
    const checkbox=document.createElement("input");
    checkbox.type="checkbox";
    checkbox.checked=currentQuest.completedSteps[idx];
    checkbox.onchange=()=>{
      currentQuest.completedSteps[idx]=checkbox.checked;
      updateProgress();
    };
    li.appendChild(checkbox);
    li.appendChild(document.createTextNode(" "+step));
    list.appendChild(li);
  });

  updateProgress();
}

// Mise à jour progression
function updateProgress(){
  if(!currentQuest) return;
  const completed=currentQuest.completedSteps.filter(v=>v).length;
  const progress=Math.round((completed/currentQuest.steps.length)*100);

  document.getElementById("questProgress").textContent=progress+"%";
  document.getElementById("progressBar").style.width=progress+"%";

  // Mise à jour liste des quêtes
  const questListItems=document.querySelectorAll("#questsList li");
  currentTheme.quests.forEach((q,idx)=>{
    const qProgress=Math.round((q.completedSteps.filter(v=>v).length / q.steps.length)*100);
    const questLi=questListItems[idx];
    if(questLi){
      const questProgressBar=questLi.querySelector(".progress-bar");
      const questProgressText=questLi.querySelector(".quest-progress-text");
      if(questProgressBar) questProgressBar.style.width=qProgress+"%";
      if(questProgressText) questProgressText.textContent="Progression : "+qProgress+"%";
    }
  });

  // Mise à jour page thèmes
  const themeIndex=data.themes.indexOf(currentTheme);
  const themeCards=document.querySelectorAll("#themesGrid .card");
  if(themeCards[themeIndex]){
    let total=0;
    currentTheme.quests.forEach(q=>{ total+=Math.round((q.completedSteps.filter(v=>v).length/q.steps.length)*100); });
    const themeProgress=Math.round(total/currentTheme.quests.length);

    const themeProgressBar=themeCards[themeIndex].querySelector(".progress-bar");
    const themeProgressText=themeCards[themeIndex].querySelector(".theme-progress-text");
    if(themeProgressBar) themeProgressBar.style.width=themeProgress+"%";
    if(themeProgressText) themeProgressText.textContent="Progression : "+themeProgress+"%";
  }
}

// Initialisation
showThemes();
</script>
</body>
</html>
